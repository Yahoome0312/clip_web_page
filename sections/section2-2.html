<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2.2 Contrastive Mechanism - CLIP Methodology</title>
    <link rel="stylesheet" href="../assets/styles/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body, {
        delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\[', right: '\]', display: true}
        ]
    });"></script>
    <style>
        .sim-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 8px;
            margin: 2rem 0;
        }
        .sim-table th, .sim-table td {
            text-align: center;
            vertical-align: middle;
            padding: 10px;
            border-radius: 8px;
            position: relative;
        }
        /* Headers */
        .col-header { background: #f1f5f9; color: #475569; font-size: 0.9rem; border: 1px solid #e2e8f0; }
        .row-header { background: #f1f5f9; font-weight: bold; width: 120px; border: 1px solid #e2e8f0; }
        
        /* Matrix Cells */
        .cell {
            background: #ffffff;
            color: #64748b;
            font-family: monospace;
            transition: all 0.3s ease;
            cursor: default;
            border: 1px solid #e2e8f0;
        }
        .cell:hover { transform: scale(1.05); z-index: 10; border: 1px solid var(--primary-color); }
        
        /* Highlight Types */
        .diagonal {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid #10b981;
            color: #10b981;
            font-weight: bold;
        }
        .off-diagonal {
            background: rgba(239, 68, 68, 0.1);
            border: 1px dashed #ef4444;
            color: #ef4444;
        }

        /* Connecting Lines (Conceptual) */
        .arrow-down { font-size: 1.5rem; color: #64748b; text-align: center; }
        
        .matrix-legend {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        .legend-item { display: flex; align-items: center; gap: 0.5rem; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
    </style>
</head>
<body>

    <header>
        <nav>
            <div class="logo">CLIP</div>
            <div class="nav-links">
                <a href="../index.html">Home</a>
                <a href="section1-1.html">1. Background</a>
                <a href="section2-1.html" class="active">2. Methodology</a>
                <a href="section3.html">3. Applications</a>
                <a href="section4.html">4. Conclusion</a>
            </div>
        </nav>
    </header>

    <main>
        <h1>2. Methodology: Deep Dive</h1>
        
        <div class="chapter-nav">
            <a href="section2-1.html">2.1 Two-Stream Architecture</a>
            <a href="section2-2.html" class="active-chapter">2.2 Contrastive Mechanism</a>
            <a href="section2-3.html">2.3 The Math of Loss</a>
        </div>

        <section class="content-section">
            <h2>2.2 The Contrastive Mechanism</h2>
            <p>
                Once we have encoded our images and text into vectors, how do we actually "teach" the model?
                CLIP uses a technique called <strong>Contrastive Learning</strong>.
                <br>Imagine an ideal scenario. We have <em>a photo of a dog</em> and <em>the text "it is a dog"</em>. When these inputs pass through their respective encoders, they become series of numbers. We expect that the numerical sequence in this text should be very close to, or even identical to, the numerical sequence in this image.
            </p>


            <h3 style="color: var(--secondary-color);">1. The Ruler: Cosine Similarity</h3>
            <p>
                How do we quantify if two series of numbers are "close"? We use a convenient tool: <strong>Cosine Similarity</strong>.
            </p>
            <p>
                Given two attribute vectors $A$ and $B$ (which correspond to image vector and text vector in CLIP), their cosine similarity $\theta$ is given by the dot product and vector lengths. The formula is as follows:
            </p>

            <div style="background: #f1f5f9; padding: 1.5rem; border-radius: 8px; text-align: center; margin: 1.5rem 0; border: 1px solid #e2e8f0;">
                $$\mathrm{similarity}=\cos{\left(\theta\right)}=\frac{A\cdot B}{|A||B|}=\frac{\sum_{i=1}^{n}A_i\times B_i}{\sqrt{\sum_{i=1}^{n}\left(A_i\right)^2}\times\sqrt{\sum_{i=1}^{n}\left(B_i\right)^2}}$$
            </div>

            <p style="font-size: 0.95rem; color: var(--text-color);">
                Here, $A_i$, $B_i$ represent the individual components of vectors $A$ and $B$.
            </p>

            <div style="display: flex; gap: 2rem; align-items: center; margin: 2rem 0; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 300px;">
                    <img src="../assets/images/cosine.png" alt="Cosine Similarity Illustration" style="width: 100%; max-width: 400px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid var(--border-color);">
                </div>
                <div style="flex: 1; min-width: 300px;">
                    <div style="background: var(--card-bg); padding: 1.5rem; border-radius: 10px; border: 1px solid var(--border-color); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <h4 style="color: var(--primary-color); margin-bottom: 1rem;">Similarity Range:</h4>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li style="padding: 0.5rem 0; border-bottom: 1px solid #f1f5f9;"><strong>+1:</strong> Vectors point in exactly the same direction</li>
                            <li style="padding: 0.5rem 0; border-bottom: 1px solid #f1f5f9;"><strong>0:</strong> Vectors are orthogonal</li>
                            <li style="padding: 0.5rem 0;"><strong>-1:</strong> Vectors point in exactly opposite directions</li>
                        </ul>
                        <p style="margin-top: 1rem; font-size: 0.9rem; color: #64748b; font-style: italic;">
                            Values in between represent varying degrees of similarity or dissimilarity.
                        </p>
                    </div>
                </div>
            </div>

            <p>
                The core idea is to train on a <strong>Batch</strong> of $N$ pairs simultaneously.
                Instead of asking "Is this image a dog?", we ask:
                <em>"Out of all these $N$ captions, which one matches this image best?"</em>
            </p>

            <h3>2. The $N \times N$ Similarity Matrix</h3>
            <p>
                Let's visualize a mini-batch where $N=3$, which gives us a matrix of size $3 \times 3$. We calculate the Cosine Similarity for every possible pair.
            </p>

            <div class="visual-container" style="display: block; background: #f8fafc; padding: 2rem; border: 1px solid #e2e8f0;">
                
                <table class="sim-table">
                    <!-- Text Headers -->
                    <tr>
                        <th style="background: transparent;"></th>
                        <th class="col-header">
                            <div style="padding: 0.5rem; background: #f1f5f9; border-radius: 6px;">
                                $T_1$: "A cute puppy"
                            </div>
                        </th>
                        <th class="col-header">
                            <div style="padding: 0.5rem; background: #f1f5f9; border-radius: 6px;">
                                $T_2$: "A fresh salad"
                            </div>
                        </th>
                        <th class="col-header">
                            <div style="padding: 0.5rem; background: #f1f5f9; border-radius: 6px;">
                                $T_3$: "Rocket launch"
                            </div>
                        </th>
                    </tr>

                    <!-- Row 1: Dog -->
                    <tr>
                        <th class="row-header">
                            <img src="../assets/images/dog.jpg" style="width: 80px; height: 80px; object-fit: cover; border-radius: 6px;">
                            <div style="margin-top: 4px; font-size: 0.8rem; color: #3b82f6;">Image $I_1$</div>
                        </th>
                        <td class="cell diagonal">
                            $I_1 \cdot T_1$
                        </td>
                        <td class="cell off-diagonal">
                            $I_1 \cdot T_2$
                        </td>
                        <td class="cell off-diagonal">
                            $I_1 \cdot T_3$
                        </td>
                    </tr>

                    <!-- Row 2: Salad -->
                    <tr>
                        <th class="row-header">
                            <img src="../assets/images/salad.jpg" style="width: 80px; height: 80px; object-fit: cover; border-radius: 6px; border: 1px solid #e2e8f0;">
                            <div style="margin-top: 4px; font-size: 0.8rem; color: #3b82f6;">Image $I_2$</div>
                        </th>
                        <td class="cell off-diagonal">
                            $I_2 \cdot T_1$
                        </td>
                        <td class="cell diagonal">
                            $I_2 \cdot T_2$
                        </td>
                        <td class="cell off-diagonal">
                            $I_2 \cdot T_3$
                        </td>
                    </tr>

                    <!-- Row 3: Rocket -->
                    <tr>
                        <th class="row-header">
                            <img src="../assets/images/rocket.jpg" style="width: 80px; height: 80px; object-fit: cover; border-radius: 6px; border: 1px solid #e2e8f0;">
                            <div style="margin-top: 4px; font-size: 0.8rem; color: #3b82f6;">Image $I_3$</div>
                        </th>
                        <td class="cell off-diagonal">
                            $I_3 \cdot T_1$
                        </td>
                        <td class="cell off-diagonal">
                            $I_3 \cdot T_2$
                        </td>
                        <td class="cell diagonal">
                            $I_3 \cdot T_3$
                        </td>
                    </tr>
                </table>

                <div class="matrix-legend">
                    <div class="legend-item">
                        <div class="dot" style="background: #10b981;"></div>
                        <span><strong>Positive Pairs ($N$):</strong> Correct matches (Diagonal) &rarr; Maximize Similarity</span>
                    </div>
                    <div class="legend-item">
                        <div class="dot" style="background: #ef4444;"></div>
                        <span><strong>Negative Pairs ($N^2 - N$):</strong> Mismatches &rarr; Minimize Similarity</span>
                    </div>
                </div>
            </div>

            <h3>Why is this powerful?</h3>
            <p>
                CLIP uses 32768 image-text pairs every single batch, which is a pretty big batch size compared to a more traditional approach which might see a batch size of 16~64. As a result, CLIP is forced to be really good at getting positive pairs far away from a large number of negative pairs.
            </p>
            
        </section>

        <div class="page-nav">
            <a href="section2-1.html" class="btn btn-secondary">&larr; Previous</a>
            <a href="section2-3.html" class="btn">Next: 2.3 The Math of Loss &rarr;</a>
        </div>

    </main>
</body>
</html>